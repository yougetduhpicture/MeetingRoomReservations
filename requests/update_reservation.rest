### ===========================================
### UPDATE RESERVATION (OVERLAP) REQUESTS
### ===========================================
### This demonstrates the overlap handling behavior:
### - Same user overlapping → UPDATE existing reservation
### - Different user overlapping → CONFLICT error (409)
### ===========================================

@baseUrl = http://localhost:3000/api

### PASTE YOUR TOKENS HERE (get from login.rest)
@aliceToken = YOUR_ALICE_TOKEN_HERE
@bobToken = YOUR_BOB_TOKEN_HERE

### -----------------------------------------
### SCENARIO: Same user creates overlapping reservation
### -----------------------------------------
### Alice already has res-1: room-1, 2026-06-02, 09:00-10:00
### If Alice tries to book room-1, 2026-06-02, 09:00-10:00 again,
### it should UPDATE (return 200) instead of creating a duplicate

### Step 1: First, let's see Alice's existing reservation
### (res-1: Conference Room A, June 2, 2026, 09:00-10:00)

GET {{baseUrl}}/rooms/room-1/reservations
Authorization: Bearer {{aliceToken}}

###

### Step 2: Alice creates overlapping reservation (same time slot)
### This should UPDATE the existing reservation (res-1)
### Response: 200 with "reservation has been updated" message

POST {{baseUrl}}/reservations
Content-Type: application/json
Authorization: Bearer {{aliceToken}}

{
  "roomId": "room-1",
  "date": "2026-06-02",
  "startTime": "09:00",
  "endTime": "10:00"
}

### -----------------------------------------
### SCENARIO: Different user creates overlapping reservation
### -----------------------------------------
### Alice has a reservation at room-1, 2026-06-02, 09:00-10:00
### Bob tries to book the same slot → should get 409 Conflict
### The error message includes nearest available time slots!
### If the same day has no slots, it suggests slots from adjacent dates.
###
### Example response (same-day slots available):
### {
###   "error": "ConflictError",
###   "message": "Conference Room A is already booked from 09:00-10:00 on 2026-06-02
###              by Alice Johnson. Nearest available slots: 08:00-09:00 (earlier)
###              or 10:00-11:00 (later).",
###   "statusCode": 409
### }
###
### Example response (no same-day slots, searching adjacent dates):
### The system searches up to 30 days in each direction until finding available slots.
### {
###   "error": "ConflictError",
###   "message": "Conference Room A is already booked from 09:00-10:00 on 2026-06-02
###              by Alice Johnson. Nearest available slots: 2026-06-01 at 23:00-00:00
###              or 2026-06-03 at 00:00-01:00.",
###   "statusCode": 409
### }

### Bob tries to book Alice's slot (should fail - 409 with suggestions)

POST {{baseUrl}}/reservations
Content-Type: application/json
Authorization: Bearer {{bobToken}}

{
  "roomId": "room-1",
  "date": "2026-06-02",
  "startTime": "09:00",
  "endTime": "10:00"
}

### -----------------------------------------
### SCENARIO: Create reservation that overlaps with Bob's
### -----------------------------------------
### Bob has res-2: room-1, 2026-06-02, 14:00-15:00
### Alice tries to book the same slot → should get 409 Conflict

POST {{baseUrl}}/reservations
Content-Type: application/json
Authorization: Bearer {{aliceToken}}

{
  "roomId": "room-1",
  "date": "2026-06-02",
  "startTime": "14:00",
  "endTime": "15:00"
}

### -----------------------------------------
### SCENARIO: Non-overlapping reservation (should succeed)
### -----------------------------------------
### Book a different time slot on the same day

POST {{baseUrl}}/reservations
Content-Type: application/json
Authorization: Bearer {{aliceToken}}

{
  "roomId": "room-1",
  "date": "2026-06-02",
  "startTime": "11:00",
  "endTime": "12:00"
}
